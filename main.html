<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AB AGRIWEB - Dashboard</title>
<style>
  :root{
    --bg:#0f172a; --panel:#0b1220; --text:#e2e8f0; --accent:#22c55e; --border:#243046;
    --tile:#0c1526; --tileIcon:#0f1a2e; --warn:#fde68a1a;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg),#1e293b); color:var(--text);
    min-height:100vh; overflow-x:hidden;
  }
  .hidden{display:none !important;}

  /* Header */
  header{
    position:sticky; top:0; z-index:20;
    display:flex; align-items:center; justify-content:space-between;
    background:var(--panel); padding:12px 18px; border-bottom:1px solid var(--border);
    box-shadow:0 2px 12px rgba(0,0,0,.25);
  }
  .menu-btn{ background:none; border:none; color:var(--text); font-size:24px; cursor:pointer; }
  .title{ font-weight:800; color:var(--accent); letter-spacing:.5px }

  /* Sidebar */
  .sidebar{
    position:fixed; top:0; left:-260px; width:260px; height:100%;
    background:#0b1220; border-right:1px solid var(--border);
    transition:left .35s ease; display:flex; flex-direction:column; padding-top:56px;
    box-shadow:4px 0 20px rgba(0,0,0,.4); z-index:15;
  }
  .sidebar.active{ left:0; }
  .side-header{
    position:absolute; top:0; left:0; right:0; height:56px;
    display:flex; align-items:center; gap:10px; padding:0 14px;
    border-bottom:1px solid #1e293b; background:#0b1220;
  }
  .close-btn{
    width:36px; height:36px; border:none; border-radius:8px; cursor:pointer;
    background:#111827; color:#e2e8f0; font-size:22px; line-height:1;
  }
  .close-btn:hover{ background:#0f172a; }
  .close-btn:active{ background:#1e293b; }
  .side-header span{ font-weight:700; color:#cbd5e1 }

  .sidebar a{
    display:flex; align-items:center; gap:10px; padding:14px 24px;
    color:var(--text) !important; text-decoration:none; border-bottom:1px solid #1e293b;
  }
  .sidebar a:hover{ background:var(--accent); color:#0b1220 !important; font-weight:600; }
  .sidebar a.active{ background:var(--accent); color:#0b1220 !important; font-weight:700; }

  /* Overlay */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.4);
    opacity:0; pointer-events:none; transition:opacity .3s ease; z-index:10;
  }
  .overlay.active{ opacity:1; pointer-events:all; }

  /* Cards */
  .content{ padding:24px; }
  .card{
    max-width:1000px; margin:16px auto; background:#0b1220; border:1px solid var(--border);
    border-radius:16px; padding:20px; box-shadow:0 10px 24px rgba(0,0,0,.25);
    position:relative;
  }
  .muted{opacity:.8}
  .hint{background:var(--warn); border:1px dashed #fbbf24; color:#fcd34d; padding:8px 10px; border-radius:8px; font-size:13px;}

  /* Tiles */
  .stack{ display:grid; gap:12px; }
  .tile{
    display:flex; align-items:center; gap:12px;
    background:var(--tile); border:1px solid var(--border); border-radius:12px;
    padding:14px 16px; cursor:pointer;
  }
  .tile:hover{ border-color:var(--accent); box-shadow:0 0 0 2px rgba(34,197,94,.25) inset; }
  .tile .icon{
    width:36px; height:36px; display:grid; place-items:center;
    background:var(--tileIcon); border:1px solid #1f2a44; border-radius:10px;
  }
  .tile h4{ margin:0; font-size:16px; }
  .tile p{ margin:2px 0 0; font-size:12px; color:#94a3b8; }

  /* Top-right actions */
  .actions-top{
    position:absolute; top:16px; right:16px; display:flex; gap:8px;
  }
  .btn{ padding:10px 12px; border-radius:10px; border:1px solid #22c55e; color:#22c55e; background:transparent; cursor:pointer }
  .btn:hover{ background:#22c55e; color:#0b1220 }
  .btn.icon{ width:40px; height:40px; display:grid; place-items:center; padding:0; }
  .btn.danger{ border-color:#3b1f1f; color:#fca5a5; }
  .btn.danger:hover{ background:#ef4444; color:#0b1220; border-color:#ef4444; }

  /* Forms & lists */
  .row{ display:flex; gap:10px; flex-wrap:wrap; }
  .input, select, textarea{ width:100%; max-width:360px; padding:12px; border-radius:10px; border:1px solid #334155; background:#091227; color:#e2e8f0; }
  .list{ display:grid; gap:10px; margin-top:14px; }
  .item{
    display:grid; grid-template-columns: 1fr auto; align-items:center; gap:10px;
    background:#0c1526; border:1px solid #243046; border-radius:10px; padding:12px 14px;
  }
  .meta{ display:flex; gap:12px; flex-wrap:wrap; font-size:14px; color:#cbd5e1 }
  .meta b{ color:#e2e8f0 }
  .actions{ display:flex; gap:8px }
  .actions .btn{ min-width:42px; }

  /* Simple grid for app settings */
  .grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); }
  .label{ font-size:13px; color:#9fb2cc; margin-bottom:6px; display:block; }
  .sectionTitle{ margin:16px 0 8px; font-weight:700; color:#cde4d5 }

  /* ===== Modal (new fix) ===== */
  .modal-wrap{
    position: fixed; inset: 0;
    display: grid; place-items: center;
    z-index: 60;
  }
  .modal-wrap:not(.show){ display: none; } /* مخفي افتراضياً */

  .modal-bg{
    position: absolute; inset: 0;
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(2px);
  }

  .modal{
    position: relative;
    width: min(520px, 92vw);
    background: #0b1220;
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 16px;
    box-shadow: 0 18px 40px rgba(0,0,0,.45);
  }

  .modal h3{ margin: 0 0 12px; }
  .right{ display:flex; gap:8px; justify-content:flex-end; }
</style>
</head>
<body>

<!-- باقي الواجهة والسكربت مثل النسخة السابقة -->

<!-- مودالات التعديل -->
<div id="opModal" class="modal-wrap">
  <div class="modal-bg" onclick="opCloseModal()"></div>
  <div class="modal">
    <h3>Modifier l’opérateur</h3>
    <div class="row">
      <input id="edit_username" class="input" placeholder="Nom d’utilisateur">
      <input id="edit_password" type="password" class="input" placeholder="Mot de passe">
    </div>
    <div class="row">
      <select id="edit_profile" class="input"></select>
      <div class="combo" id="combo-edit-ferme" style="max-width:360px; width:100%">
        <input id="edit_ferme_input" class="input" placeholder="Chercher/choisir une ferme...">
        <div id="edit_ferme_list" class="combo-list hidden"></div>
        <input type="hidden" id="edit_ferme" />
      </div>
    </div>
    <div class="right" style="margin-top:8px">
      <button class="btn danger" onclick="opCloseModal()">Annuler</button>
      <button class="btn" onclick="opSaveEdit()">Enregistrer</button>
    </div>
  </div>
</div>

<div id="farmModal" class="modal-wrap">
  <div class="modal-bg" onclick="farmCloseModal()"></div>
  <div class="modal">
    <h3>Modifier la ferme</h3>
    <div class="row">
      <input id="edit_farm_name" class="input" placeholder="Nom de la ferme">
      <input id="edit_farm_area" class="input" placeholder="Surface">
    </div>
    <div class="row">
      <input id="edit_farm_company" class="input" placeholder="Société">
      <input id="edit_farm_location" class="input" placeholder="Emplacement">
    </div>
    <div class="row">
      <input id="edit_farm_manager" class="input" placeholder="Responsable">
      <input id="edit_farm_phone" class="input" placeholder="Téléphone">
    </div>
    <div class="right" style="margin-top:8px">
      <button class="btn danger" onclick="farmCloseModal()">Annuler</button>
      <button class="btn" onclick="farmSaveEdit()">Enregistrer</button>
    </div>
  </div>
</div>

<!-- كل سكربتات المشروع تبقى نفسها -->
<script>
  /* هنا كيبقى نفس كود الجافاسكريبت اللي كان فالإصدار السابق */
</script>

</body>
</html>
