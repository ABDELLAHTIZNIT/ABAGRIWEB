<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AB AGRIWEB - Dashboard</title>
<style>
:root{--bg:#0f172a;--panel:#0b1220;--text:#e2e8f0;--accent:#22c55e;--border:#243046;--tile:#0c1526;--tileIcon:#0f1a2e;--warn:#fde68a1a}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#1e293b);color:#e2e8f0;min-height:100vh;overflow-x:hidden}
.hidden{display:none!important}
header{position:sticky;top:0;z-index:20;display:flex;align-items:center;justify-content:space-between;background:var(--panel);padding:12px 18px;border-bottom:1px solid var(--border);box-shadow:0 2px 12px rgba(0,0,0,.25)}
.menu-btn{background:none;border:none;color:var(--text);font-size:24px;cursor:pointer}
.brand{display:flex;align-items:center;gap:10px}
.title{font-weight:800;color:var(--accent);letter-spacing:.5px;display:flex;align-items:center;gap:10px}
.badge-img{height:22px;border-radius:6px;border:1px solid #1f2937}
.sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#0b1220;border-right:1px solid var(--border);transition:left .35s ease;display:flex;flex-direction:column;padding-top:56px;box-shadow:4px 0 20px rgba(0,0,0,.4);z-index:15}
.sidebar.active{left:0}
.side-header{position:absolute;top:0;left:0;right:0;height:56px;display:flex;align-items:center;gap:10px;padding:0 14px;border-bottom:1px solid #1e293b;background:#0b1220}
.close-btn{width:36px;height:36px;border:none;border-radius:8px;cursor:pointer;background:#111827;color:#e2e8f0;font-size:22px}
.sidebar a{display:flex;align-items:center;gap:10px;padding:14px 24px;color:var(--text)!important;text-decoration:none;border-bottom:1px solid #1e293b}
.sidebar a:hover{background:var(--accent);color:#0b1220!important;font-weight:600}
.sidebar a.active{background:var(--accent);color:#0b1220!important;font-weight:700}
.sidebar-brand{padding:12px 18px;border-bottom:1px solid #1e293b}
.sidebar-brand img{width:100%;border-radius:10px;border:1px solid #1f2937}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .3s ease;z-index:10}
.overlay.active{opacity:1;pointer-events:all}
.content{padding:24px}
.card{max-width:1000px;margin:16px auto;background:#0b1220;border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 10px 24px rgba(0,0,0,.25);position:relative}
.muted{opacity:.8}
.hint{background:var(--warn);border:1px dashed #fbbf24;color:#fcd34d;padding:8px 10px;border-radius:8px;font-size:13px}
.stack{display:grid;gap:12px}
.tile{display:flex;align-items:center;gap:12px;background:var(--tile);border:1px solid var(--border);border-radius:12px;padding:14px 16px;cursor:pointer}
.tile:hover{border-color:var(--accent);box-shadow:0 0 0 2px rgba(34,197,94,.25) inset}
.tile .icon{width:36px;height:36px;display:grid;place-items:center;background:var(--tileIcon);border:1px solid #1f2a44;border-radius:10px}
.tile h4{margin:0;font-size:16px}.tile p{margin:2px 0 0;font-size:12px;color:#94a3b8}
.actions-top{position:absolute;top:16px;right:16px;display:flex;gap:8px}
.btn{padding:10px 12px;border-radius:10px;border:1px solid #22c55e;color:#22c55e;background:transparent;cursor:pointer}
.btn:hover{background:#22c55e;color:#0b1220}.btn.icon{width:40px;height:40px;display:grid;place-items:center;padding:0}
.btn.danger{border-color:#3b1f1f;color:#fca5a5}.btn.danger:hover{background:#ef4444;color:#0b1220;border-color:#ef4444}
.row{display:flex;gap:10px;flex-wrap:wrap}
.input,select,textarea{width:100%;max-width:360px;padding:12px;border-radius:10px;border:1px solid #334155;background:#091227;color:#e2e8f0}
.list{display:grid;gap:10px;margin-top:14px}
.item{display:grid;grid-template-columns:1fr auto;align-items:center;gap:10px;background:#0c1526;border:1px solid #243046;border-radius:10px;padding:12px 14px}
.meta{display:flex;gap:12px;flex-wrap:wrap;font-size:14px;color:#cbd5e1}.meta b{color:#e2e8f0}
.actions{display:flex;gap:8px}.actions .btn{min-width:42px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.label{font-size:13px;color:#9fb2cc;margin-bottom:6px;display:block}.sectionTitle{margin:16px 0 8px;font-weight:700;color:#cde4d5}

/* Accordion */
.accordion{border:1px solid var(--border);border-radius:12px;margin:12px 0;background:#0b1220}
.acc-hd{width:100%;text-align:left;padding:12px 14px;background:#0c1526;border-bottom:1px solid #1e293b;border-radius:12px 12px 0 0;cursor:pointer;font-weight:700;display:flex;justify-content:space-between;align-items:center}
.acc-bd{padding:14px;display:none}
.acc.open .acc-bd{display:block}
.acc-hd span{opacity:.8}
.combo{position:relative}
.combo-list{position:absolute;left:0;right:0;top:100%;background:#0b1220;border:1px solid #334155;border-radius:10px;max-height:220px;overflow:auto;z-index:30;margin-top:6px}
.combo-item{padding:10px 12px;border-bottom:1px solid #1e293b;cursor:pointer}.combo-item:hover{background:#0f172a}
.modal-wrap{position:fixed;inset:0;display:grid;place-items:center;z-index:60}
.modal-wrap:not(.show){display:none}
.modal-bg{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px)}
.modal{position:relative;width:min(520px,92vw);background:#0b1220;border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 18px 40px rgba(0,0,0,.45)}
.right{display:flex;gap:8px;justify-content:flex-end}
</style>
</head>
<body>
<header>
  <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
  <div class="brand">
    <div class="title" id="appTitleTop">AB AGRIWEB</div>
    <img id="appBadgeImg" class="badge-img hidden" alt="">
  </div>
</header>

<aside class="sidebar" id="sidebar">
  <div class="side-header"><button class="close-btn" onclick="closeMenu()">Ã—</button><span>Menu</span></div>
  <div class="sidebar-brand hidden" id="sidebarBrand"><img id="sidebarBrandImg" alt=""></div>
  <a href="#" id="nav-home" class="active"><span id="lbl-nav-home">ğŸ  Accueil</span></a>
  <a href="#" id="nav-irrig"><span id="lbl-nav-irrig">ğŸŒ¿ Irrigation</span></a>
  <a href="#" id="nav-trait"><span id="lbl-nav-trait">ğŸ’§ Traitement</span></a>
  <a href="#" id="nav-settings"><span id="lbl-nav-settings">âš™ï¸ ParamÃ¨tres</span></a>
  <a href="#" id="logout"><span id="lbl-nav-logout">ğŸšª Logout</span></a>
</aside>
<div class="overlay" id="overlay"></div>

<main class="content">
  <!-- Accueil -->
  <section id="page-home" class="card">
    <h2>Bienvenue ğŸ‘‹</h2>
    <p class="muted">Page dâ€™accueil temporaire.</p>
    <div id="firstRunHint" class="hint hidden" style="margin-top:10px">ğŸ” Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù…. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <b>ParamÃ¨tres â†’ OpÃ©rateurs</b> ÙˆØ£Ø¶Ù Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù….</div>
  </section>

  <!-- ParamÃ¨tres (menu tuiles) -->
  <section id="page-settings" class="card hidden">
    <h2 id="title-settings">ParamÃ¨tres</h2>
    <p class="muted">Choisissez un module.</p>
    <div class="stack">
      <div class="tile" onclick="showPage('operators');setActiveTile()"><div class="icon">ğŸ‘¥</div><div><h4 id="lbl-tile-operators">OPÃ‰RATEUR</h4><p>Gestion des utilisateurs</p></div></div>
      <div class="tile" onclick="showPage('profiles');setActiveTile()"><div class="icon">ğŸ§©</div><div><h4 id="lbl-tile-profiles">PROFILE</h4><p>Gestion des profils</p></div></div>
      <div class="tile" onclick="showPage('refs');setActiveTile()"><div class="icon">ğŸ—‚ï¸</div><div><h4 id="lbl-tile-refs">RÃ‰FÃ‰RENTIELS</h4><p>Listes maÃ®tres</p></div></div>
      <div class="tile" onclick="alert('DROITS ACCÃˆS (Ã  complÃ©ter)')"><div class="icon">ğŸ›¡ï¸</div><div><h4 id="lbl-tile-rights">DROITS ACCÃˆS</h4><p>Permissions</p></div></div>
      <div class="tile" onclick="alert('MOT DE PASSE (Ã  complÃ©ter)')"><div class="icon">ğŸ”‘</div><div><h4 id="lbl-tile-pass">MOT DE PASSE</h4><p>Changer le mot de passe</p></div></div>
      <div class="tile" onclick="showPage('appcfg');setActiveTile()"><div class="icon">âš™ï¸</div><div><h4 id="lbl-tile-appcfg">RÃ‰GLAGES APP</h4><p>Logo, labels & sÃ©curitÃ©</p></div></div>
    </div>
  </section>

  <!-- Profiles -->
  <section id="page-profiles" class="card hidden">
    <div class="actions-top"><button class="btn icon" title="Ajouter" onclick="toggleAddForm(true)">â•</button><button class="btn icon" title="Aide" onclick="showProfilesHint()">âœï¸</button></div>
    <h2>Profiles</h2>
    <div id="profilesHint" class="hint hidden">Ø§Ø³ØªØ¹Ù…Ù„ âœï¸ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.</div>
    <div id="addForm" class="row hidden" style="margin-top:12px">
      <input id="profileName" class="input" placeholder="Ex: Admin, Magasinier, Pointeur, Directeur">
      <button class="btn" onclick="addProfile()">Confirmer</button>
      <button class="btn danger" onclick="toggleAddForm(false)">Annuler</button>
    </div>
    <div id="profilesList" class="list" style="margin-top:14px"></div>
  </section>

  <!-- Operators -->
  <section id="page-operators" class="card hidden">
    <div class="actions-top"><button class="btn icon" onclick="opToggleForm(true)">â•</button><button class="btn icon" onclick="showOpsHint()">âœï¸</button></div>
    <h2>OpÃ©rateurs</h2>
    <div id="opsHint" class="hint hidden">Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ø³ØªØ¹Ù…Ù„ âœï¸.</div>
    <div id="opAddForm" class="row hidden" style="margin-top:12px">
      <input id="op_username" class="input" placeholder="Nom dâ€™utilisateur">
      <input id="op_password" type="password" class="input" placeholder="Mot de passe">
      <select id="op_profile" class="input"></select>
      <div class="combo" id="combo-op-ferme" style="max-width:360px;width:100%">
        <input id="op_ferme_input" class="input" placeholder="Chercher/choisir une ferme...">
        <div id="op_ferme_list" class="combo-list hidden"></div>
        <input type="hidden" id="op_ferme"/>
      </div>
      <button class="btn" onclick="opAdd()">Confirmer</button>
      <button class="btn danger" onclick="opToggleForm(false)">Annuler</button>
    </div>
    <div id="operatorsList" class="list" style="margin-top:14px"></div>
  </section>

  <!-- Fermes -->
  <section id="page-farms" class="card hidden">
    <div class="actions-top"><button class="btn icon" onclick="farmToggleForm(true)">â•</button><button class="btn icon" onclick="showFarmsHint()">âœï¸</button></div>
    <h2>Fermes</h2>
    <div id="farmsHint" class="hint hidden">Ø§Ø³ØªØ¹Ù…Ù„ âœï¸ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.</div>
    <div id="farmAddForm" class="row hidden" style="margin-top:12px">
      <input id="farm_name" class="input" placeholder="Nom de la ferme (ex: Karam 16)">
      <input id="farm_area" class="input" placeholder="Surface (ex: 12 ha)">
      <input id="farm_company" class="input" placeholder="SociÃ©tÃ©">
      <input id="farm_location" class="input" placeholder="Emplacement">
      <input id="farm_manager" class="input" placeholder="Responsable">
      <input id="farm_phone" class="input" placeholder="TÃ©lÃ©phone du responsable">
      <button class="btn" onclick="farmAdd()">Confirmer</button>
      <button class="btn danger" onclick="farmToggleForm(false)">Annuler</button>
    </div>
    <div id="farmsList" class="list" style="margin-top:14px"></div>
  </section>

  <!-- RÃ©fÃ©rentiels -->
  <section id="page-refs" class="card hidden">
    <h2>RÃ©fÃ©rentiels</h2><p class="muted">Ù„ÙˆØ§Ø¦Ø­ Ù…Ø±Ø¬Ø¹ÙŠØ©.</p>
    <div id="refsHome" class="stack">
      <div class="tile" onclick="showPage('farms');setActiveTile()"><div class="icon">ğŸï¸</div><div><h4 id="lbl-ref-ferme">Ferme</h4></div></div>
      <div class="tile" onclick="refsOpen('companies')"><div class="icon">ğŸ¢</div><div><h4 id="lbl-ref-companies">SociÃ©tÃ©</h4></div></div>
      <div class="tile" onclick="refsOpen('responsables')"><div class="icon">ğŸ‘¤</div><div><h4 id="lbl-ref-responsables">Responsable</h4></div></div>
      <div class="tile" onclick="refsOpen('stations')"><div class="icon">ğŸš</div><div><h4 id="lbl-ref-stations">Station</h4></div></div>
      <div class="tile" onclick="refsOpen('secteurs')"><div class="icon">ğŸ§­</div><div><h4 id="lbl-ref-secteurs">Secteur</h4></div></div>
      <div class="tile" onclick="refsOpen('parcelles')"><div class="icon">ğŸ§±</div><div><h4 id="lbl-ref-parcelles">Parcelle</h4></div></div>
      <div class="tile" onclick="refsOpen('transports')"><div class="icon">ğŸšš</div><div><h4 id="lbl-ref-transports">Transport</h4></div></div>
      <div class="tile" onclick="refsOpen('varietes')"><div class="icon">ğŸŒ±</div><div><h4 id="lbl-ref-varietes">VariÃ©tÃ©</h4></div></div>
      <div class="tile" onclick="refsOpen('varietes_champ')"><div class="icon">ğŸŒ¿</div><div><h4 id="lbl-ref-varietes_champ">VariÃ©tÃ© champ</h4></div></div>
      <div class="tile" onclick="refsOpen('gestions')"><div class="icon">ğŸ“¦</div><div><h4 id="lbl-ref-gestions">Gestion stock</h4></div></div>
      <div class="tile" onclick="refsOpen('achats')"><div class="icon">ğŸ§¾</div><div><h4 id="lbl-ref-achats">Achat</h4></div></div>
    </div>

    <div id="refsCat" class="hidden">
      <div class="actions-top"><button class="btn icon" onclick="refsToggleForm(true)">â•</button><button class="btn icon" onclick="toggleRefsHint()">âœï¸</button></div>
      <h3 id="refsCatTitle" style="margin-top:0">CatÃ©gorie</h3>
      <div id="refsHint" class="hint hidden">Ø§Ø³ØªØ¹Ù…Ù„ âœï¸ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ùˆ ğŸ—‘ï¸ Ù„Ù„Ø­Ø°Ù.</div>
      <div id="refsAddForm" class="row hidden" style="margin-top:12px">
        <input id="refsInput" class="input" placeholder="Nom Ã  ajouter">
        <button class="btn" onclick="refsAdd()">Confirmer</button>
        <button class="btn danger" onclick="refsToggleForm(false)">Annuler</button>
      </div>
      <div id="refsList" class="list" style="margin-top:14px"></div>
    </div>
  </section>

  <!-- RÃ©glages app (ÙƒÙ„ Ù‚Ø³Ù… Ø¨ÙˆØ­Ø¯Ùˆ) -->
  <section id="page-appcfg" class="card hidden">
    <h2>RÃ©glages de lâ€™application</h2>
    <p class="muted">ÙƒÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¬Ù…Ù‘Ø¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹.</p>

    <!-- 1) GÃ©nÃ©ral -->
    <div class="accordion acc open" id="acc-general">
      <button class="acc-hd" onclick="toggleAcc('acc-general')">1) GÃ©nÃ©ral <span>Nom/Logo de lâ€™app</span></button>
      <div class="acc-bd">
        <div class="grid">
          <div>
            <label class="label">Logo de lâ€™application (PNG/GIF)</label>
            <input id="cfg-logo-url" class="input" placeholder="URL (png/gif)">
            <input id="cfg-logo-file" type="file" accept="image/png,image/gif" class="input">
          </div>
        </div>
      </div>
    </div>

    <!-- 2) LibellÃ©s Navigation -->
    <div class="accordion acc" id="acc-nav">
      <button class="acc-hd" onclick="toggleAcc('acc-nav')">2) LibellÃ©s Navigation <span>Accueil â€¢ Irrigation â€¢ Traitement â€¢ ParamÃ¨tres â€¢ Logout</span></button>
      <div class="acc-bd">
        <div class="grid">
          <div><label class="label">Accueil</label><input id="cfg-nav-home" class="input" placeholder="Accueil"></div>
          <div><label class="label">Irrigation</label><input id="cfg-nav-irrig" class="input" placeholder="Irrigation"></div>
          <div><label class="label">Traitement</label><input id="cfg-nav-trait" class="input" placeholder="Traitement"></div>
          <div><label class="label">ParamÃ¨tres</label><input id="cfg-nav-settings" class="input" placeholder="ParamÃ¨tres"></div>
          <div><label class="label">Logout</label><input id="cfg-nav-logout" class="input" placeholder="Logout"></div>
        </div>
      </div>
    </div>

    <!-- 3) Tuiles ParamÃ¨tres -->
    <div class="accordion acc" id="acc-tiles">
      <button class="acc-hd" onclick="toggleAcc('acc-tiles')">3) Tuiles ParamÃ¨tres <span>OpÃ©rateur â€¢ Profile â€¢ RÃ©fÃ©rentiel â€¢ Droits â€¢ Mot de passe</span></button>
      <div class="acc-bd">
        <div class="grid">
          <div><label class="label">OpÃ©rateur</label><input id="cfg-tile-operators" class="input" placeholder="OPÃ‰RATEUR"></div>
          <div><label class="label">Profile</label><input id="cfg-tile-profiles" class="input" placeholder="PROFILE"></div>
          <div><label class="label">RÃ©fÃ©rentiels</label><input id="cfg-tile-refs" class="input" placeholder="RÃ‰FÃ‰RENTIELS"></div>
          <div><label class="label">Droits accÃ¨s</label><input id="cfg-tile-rights" class="input" placeholder="DROITS ACCÃˆS"></div>
          <div><label class="label">Mot de passe</label><input id="cfg-tile-pass" class="input" placeholder="MOT DE PASSE"></div>
        </div>
      </div>
    </div>

    <!-- 4) SÃ©curitÃ© -->
    <div class="accordion acc" id="acc-sec">
      <button class="acc-hd" onclick="toggleAcc('acc-sec')">4) SÃ©curitÃ© <span>Email â€¢ TÃ©lÃ©phone â€¢ Question â€¢ Code</span></button>
      <div class="acc-bd">
        <div class="grid">
          <div><label class="label">Email de rÃ©cupÃ©ration</label><input id="sec-email" class="input" placeholder="ex: admin@example.com"></div>
          <div><label class="label">TÃ©lÃ©phone</label><input id="sec-phone" class="input" placeholder="+2126..."></div>
          <div><label class="label">Question secrÃ¨te</label><input id="sec-question" class="input" placeholder="Ex: Ville de naissance ?"></div>
          <div><label class="label">RÃ©ponse</label><input id="sec-answer" class="input" placeholder="Votre rÃ©ponse"></div>
          <div>
            <label class="label">Code de rÃ©cupÃ©ration</label>
            <div class="row">
              <input id="sec-code" class="input" placeholder="GÃ©nÃ©rer pour crÃ©er un code" disabled>
              <button class="btn" onclick="secGenCode()">GÃ©nÃ©rer</button>
            </div>
            <div class="muted" style="margin-top:6px">ÙŠØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§. ÙŠÙØ³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± â€œForgot passwordâ€.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 5) Branding -->
    <div class="accordion acc" id="acc-brand">
      <button class="acc-hd" onclick="toggleAcc('acc-brand')">5) Branding <span>Badge â€¢ Sidebar â€¢ Login banner â€¢ Login background</span></button>
      <div class="acc-bd">
        <div class="grid">
          <div><label class="label">Badge header</label><input id="cfg-badge-url" class="input" placeholder="URL (png/gif)"><input id="cfg-badge-file" type="file" accept="image/png,image/gif" class="input"></div>
          <div><label class="label">Sidebar banner</label><input id="cfg-side-url" class="input" placeholder="URL (png/gif)"><input id="cfg-side-file" type="file" accept="image/png,image/gif" class="input"></div>
          <div><label class="label">Login banner</label><input id="cfg-login-url" class="input" placeholder="URL (png/gif)"><input id="cfg-login-file" type="file" accept="image/png,image/gif" class="input"></div>
          <div><label class="label">Login background</label><input id="cfg-loginbg-url" class="input" placeholder="URL (png/gif)"><input id="cfg-loginbg-file" type="file" accept="image/png,image/gif" class="input"></div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:14px">
      <button class="btn" onclick="appcfgSave()">Enregistrer</button>
      <button class="btn danger" onclick="appcfgReset()">Reset (dÃ©faut)</button>
    </div>
  </section>
</main>

<!-- Modals (edit operator / farm) -->
<div id="opModal" class="modal-wrap"><div class="modal-bg" onclick="opCloseModal()"></div>
  <div class="modal"><h3>Modifier lâ€™opÃ©rateur</h3>
    <div class="row"><input id="edit_username" class="input" placeholder="Nom dâ€™utilisateur"><input id="edit_password" type="password" class="input" placeholder="Mot de passe"></div>
    <div class="row">
      <select id="edit_profile" class="input"></select>
      <div class="combo" id="combo-edit-ferme" style="max-width:360px;width:100%"><input id="edit_ferme_input" class="input" placeholder="Chercher/choisir une ferme..."><div id="edit_ferme_list" class="combo-list hidden"></div><input type="hidden" id="edit_ferme"/></div>
    </div>
    <div class="right" style="margin-top:8px"><button class="btn danger" onclick="opCloseModal()">Annuler</button><button class="btn" onclick="opSaveEdit()">Enregistrer</button></div>
  </div>
</div>

<div id="farmModal" class="modal-wrap"><div class="modal-bg" onclick="farmCloseModal()"></div>
  <div class="modal"><